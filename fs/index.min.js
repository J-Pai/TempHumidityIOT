const HOST="127.0.0.1"===window.location.hostname||"localhost"===window.location.hostname?"http://192.168.0.194":"";console.log("HOST:",HOST),window.chartColors={red:"rgb(255, 99, 132)",orange:"rgb(255, 159, 64)",yellow:"rgb(255, 205, 86)",green:"rgb(75, 192, 192)",blue:"rgb(54, 162, 235)",purple:"rgb(153, 102, 255)",grey:"rgb(201, 203, 207)"},window.chartBgColors={red:"rgb(255, 99, 132, 0.2)",orange:"rgb(255, 159, 64, 0.2)",yellow:"rgb(255, 205, 86, 0.2)",green:"rgb(75, 192, 192, 0.2)",blue:"rgb(54, 162, 235, 0.2)",purple:"rgb(153, 102, 255, 0.2)",grey:"rgb(201, 203, 207, 0.2)"},$(document).ready(function(){const e={label:"Temperature",borderColor:window.chartColors.red,backgroundColor:window.chartBgColors.red,fill:!0,yAxisID:"y-axis-1",data:[]},r={label:"Humidity",borderColor:window.chartColors.blue,backgroundColor:window.chartBgColors.blue,fill:!0,yAxisID:"y-axis-2",data:[]},t=$("#histTempHumi")[0].getContext("2d"),o=new Chart(t,{type:"line",data:{labels:[],datasets:[e,r]},options:{title:{display:!0,text:"Historical Temperature and Humidity"},scales:{yAxes:[{position:"left",id:"y-axis-1",scaleLabel:{labelString:"Temperature",display:!0}},{position:"right",id:"y-axis-2",scaleLabel:{labelString:"Humidity (%)",display:!0}}]}}});function a(){$("#refreshBtn").addClass("loading"),$.ajax({url:HOST+"/dht",timeout:2e4}).done(function(t){const a=JSON.parse(t),s=moment(Date.now()).format("MMMM Do, YYYY - HH:mm:ss"),n=parseFloat(a.t.substring(0,a.t.length-1));tempType=a.t.includes("F")?"&#176;F":"&#176;C";const l=parseFloat(a.h);$("#currTemp").html(n+tempType),$("#currHumi").html(l+"%"),$("#currTimestamp").html(s.toString()),setTimeout(function(){$("#refreshBtn").addClass("loading"),$.ajax({url:HOST+"/dht/history",timeout:2e4}).done(function(t){const a="["+t+"]",s=JSON.parse(a);o.data.labels=[],e.data=[],r.data=[],setTimeout(function(){$.ajax({url:HOST+"/uptime",timeout:2e4}).done(function(t){const a=parseInt(t),n=Date.now();s.forEach(t=>{const s=1e3*(a-parseInt(t.d)),l=new Date(n-s),i=moment(l).format("YYYY-MM-DD HH:mm:ss"),d=parseFloat(t.t.substring(0,t.t.length-1));o.options.scales.yAxes[0].scaleLabel.labelString=t.t.includes("F")?"Temperature ("+String.fromCharCode(176)+"F)":"Temperature ("+String.fromCharCode(176)+"C)";const c=parseFloat(t.h);o.data.labels.push(i),e.data.push(d),r.data.push(c)}),o.update(),$("#refreshBtn").removeClass("loading"),$("#refreshBtn").removeClass("red")}).fail(function(e,r){console.error(e,r),$("#refreshBtn").removeClass("loading"),$("#refreshBtn").addClass("red")})},1e3)}).fail(function(e,r){console.error(e,r),$("#refreshBtn").removeClass("loading"),$("#refreshBtn").addClass("red")})},1e3)}).fail(function(e,r){console.error(e,r),$("#refreshBtn").removeClass("loading"),$("#refreshBtn").addClass("red")})}a(),$("#refreshBtn").on("click",function(){$("#refreshBtn").hasClass("loading")?console.log("Refresh in Progress!"):a()})});